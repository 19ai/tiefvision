@*
* Copyright (C) 2016 Pau Carr√© Cardona - All Rights Reserved
* You may use, distribute and modify this code under the
* terms of the Apache License v2.0 (http://www.apache.org/licenses/LICENSE-2.0.txt).
*@
@(imageSearchResult: core.ImageSearchResult, masterBase: String, bboxBase: String, positive: Option[String], negative: Option[String])
@imageSearchResultDisplay = @{imageSearchResult.distanceToSimilarImages.take(15)}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>TiefVision</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="/assets/css/offcanvas.css" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-fixed-top navbar-inverse">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">TiefVision</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/">Image Gallery</a></li>
        <li><a href="/similarity_finder_upload_form">Search Using File</a></li>
      </ul>
    </div><!-- /.nav-collapse -->
  </div><!-- /.container -->
</nav><!-- /.navbar -->

<div class="container-query">
  <div class="item-query">
    <h5>Image To Search</h5>
    <img id="reference" width="310px" class="img-thumbnail"
         name="@{imageSearchResult.image}"
         src="/@{masterBase}/@{imageSearchResult.image}"/>
    <button id="save_button">Save and move to next</button>
  </div>
  <!--
  <div class="item-query">
    <h5>Dress To Search</h5>
    <img width="150px" class="img-thumbnail" src="/@{bboxBase}/@{imageSearchResult.image}"/>
  </div>
  -->
</div>
<div class="container-result">
  <div class="item-result">
    <h5 class="title-result">Closest Dress</h5>
      <img class="img-thumbnail img-result"
           id="@{imageSearchResultDisplay(0)._2}"
           src="/dresses_db/@{imageSearchResultDisplay(0)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Second Closest Dress</h5>
      <img class="img-thumbnail img-result"
           id="@{imageSearchResultDisplay(1)._2}"
           src="/dresses_db/@{imageSearchResultDisplay(1)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Third Closest Dress</h5>
      <img class="img-thumbnail img-result"
           id="@{imageSearchResultDisplay(2)._2}"
           src="/dresses_db/@{imageSearchResultDisplay(2)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Fourth Closest Dress</h5>
      <img class="img-thumbnail img-result"
           id="@{imageSearchResultDisplay(3)._2}"
           src="/dresses_db/@{imageSearchResultDisplay(3)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Fifth Closest Dress</h5>
      <img class="img-thumbnail img-result"
           id="@{imageSearchResultDisplay(4)._2}"
           src="/dresses_db/@{imageSearchResultDisplay(4)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->

  <div class="item-result">
    <h5 class="title-result">Sixth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(5)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(5)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Seventh Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(6)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(6)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Eighth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(7)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(7)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Ninth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(8)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(8)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Tenth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(9)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(9)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->

  <div class="item-result">
    <h5 class="title-result">Sixth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(10)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(10)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Seventh Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(11)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(11)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Eighth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(12)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(12)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Ninth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(13)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(13)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->
  <div class="item-result">
    <h5 class="title-result">Tenth Closest Dress</h5>
    <img class="img-thumbnail img-result"
         id="@{imageSearchResultDisplay(14)._2}"
         src="/dresses_db/@{imageSearchResultDisplay(14)._2}"/>
  </div><!--/.col-xs-6.col-lg-4-->

</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/assets/javascripts/bootstrap.min.js"></script>
<script>
  var ImageSimilarityEditor = function (positive, negative) {
    var $scope = this;

    $scope.imageResults = $('.img-result');
    $scope.reference = document.getElementById('reference');
    $scope.positive = document.getElementById('@{positive.getOrElse("")}');
    $scope.negative = document.getElementById('@{negative.getOrElse("")}');
    $scope.saveButton = document.getElementById('save_button');

    // add event listeners
    $.each($scope.imageResults, function(index, item) {
      item.addEventListener("click", function(){
        if($scope.positive) {
          if($scope.negative) {
            //reset
            $scope.positive = item;
            $scope.negative =  null;
          } else {
            $scope.negative =  item;
          }
        } else {
          $scope.positive = item;
        }
        $scope.paint()
      });
    });

    $scope.saveButton.addEventListener("click", function(){
      if($scope.positive && $scope.reference && $scope.negative) {
       window.location = "/save_similarity?" +
        "reference=" + $scope.reference.name +
        "&positive=" + $scope.positive.id  +
        "&negative=" + $scope.negative.id;
      }
    });

    $scope.paint()

  }

  ImageSimilarityEditor.prototype.paint = function () {
    var $scope = this;
    $.each($scope.imageResults, function(index, item) {
      $(item).removeClass('img-result-positive');
      $(item).removeClass('img-result-negative');
    });
    if($scope.positive){
      $($scope.positive).addClass('img-result-positive');
    }
    if($scope.negative){
      $($scope.negative).addClass('img-result-negative');
    }
  };

  var imageSimilarityEditor = new ImageSimilarityEditor()
</script>
</body>
</html>
